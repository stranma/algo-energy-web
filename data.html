<!doctype html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Data | AlgoEnergy</title>
    <meta name="description" content="Denní trh s elektřinou (CZ) — hodinové a čtvrthodinové ceny a objemy z OTE." />
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="index.html">AlgoEnergy</a>
        <nav class="nav">
          <a href="index.html">Úvod</a>
          <a href="reseni.html">Řešení</a>
          <a href="proces.html">Jak to funguje</a>
          <a href="kontakt.html">Kontakt</a>
          <a href="data.html" aria-current="page">Data</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero compact">
        <div class="container">
          <p class="eyebrow">OTE Data</p>
          <h1>Denní trh s elektřinou (CZ)</h1>
          <p class="lead">Hodinové a čtvrthodinové ceny a objemy z českého denního trhu s elektřinou. Data ze zdroje OTE.</p>
        </div>
      </section>

      <section class="section">
        <div class="container">
          <div class="data-controls" id="controls">
            <button class="active" data-year="2026">2026</button>
            <button data-year="2025">2025</button>
            <button data-year="2024">2024</button>
            <div class="separator"></div>
            <button class="active" data-res="hourly">Hodinové</button>
            <button data-res="qh">Čtvrthodinové</button>
          </div>

          <div class="table-wrap">
            <table class="data-table" id="data-table">
              <thead id="table-head"></thead>
              <tbody id="table-body"></tbody>
            </table>
            <div class="data-status" id="data-status">Načítání dat...</div>
          </div>
        </div>
      </section>

      <section class="section light">
        <div class="container">
          <h2>Stáhnout CSV</h2>
          <p>Kompletní datové soubory ke stažení ve formátu CSV.</p>

          <h3 style="margin-top: 24px;">Hodinová data</h3>
          <ul class="download-links">
            <li><a href="data/hourly/2026.csv" download>2026 — hodinové</a></li>
            <li><a href="data/hourly/2025.csv" download>2025 — hodinové</a></li>
            <li><a href="data/hourly/2024.csv" download>2024 — hodinové</a></li>
          </ul>

          <h3 style="margin-top: 24px;">Čtvrthodinová data</h3>
          <ul class="download-links">
            <li><a href="data/qh/2026.csv" download>2026 — čtvrthodinové</a></li>
            <li><a href="data/qh/2025.csv" download>2025 — čtvrthodinové</a></li>
          </ul>
          <p style="margin-top: 8px; font-size: 14px; color: #666;">Čtvrthodinová data jsou dostupná od 1. 10. 2025 (začátek QH trhu).</p>

          <h3 style="margin-top: 32px;">Poznámky k datům</h3>
          <ul style="font-size: 14px; color: #666; line-height: 1.6;">
            <li><strong>2025-07-04:</strong> OTE API poskytuje pouze hodiny 0–11. Hodiny 12–23 jsou doplněny ročním průměrem (96,96 EUR/MWh, 3656 MWh).</li>
            <li><strong>2025-03-30:</strong> Pouze 23 hodin — přechod na letní čas (hodina 02:00–03:00 neexistuje).</li>
          </ul>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-content">
        <div>
          <strong>AlgoEnergy.cz</strong>
          <p>Automatizace přípravy provozu pro agregátory flexibility.</p>
        </div>
        <div>
          <p>Kontakt</p>
          <a href="mailto:martin.stransky@algoenergy.cz">martin.stransky@algoenergy.cz</a>
        </div>
      </div>
    </footer>

    <script>
      (function () {
        let year = "2026";
        let res = "hourly";
        const tbody = document.getElementById("table-body");
        const thead = document.getElementById("table-head");
        const status = document.getElementById("data-status");

        function setActive(group, value) {
          document.querySelectorAll(`#controls button[data-${group}]`).forEach(function (b) {
            b.classList.toggle("active", b.dataset[group] === value);
          });
        }

        document.getElementById("controls").addEventListener("click", function (e) {
          const btn = e.target.closest("button");
          if (!btn) return;
          if (btn.dataset.year) {
            year = btn.dataset.year;
            setActive("year", year);
          } else if (btn.dataset.res) {
            res = btn.dataset.res;
            setActive("res", res);
          }
          loadData();
        });

        function loadData() {
          const url = "data/" + res + "/" + year + ".csv";
          status.textContent = "Načítání dat...";
          status.style.display = "block";
          thead.innerHTML = "";
          tbody.innerHTML = "";

          fetch(url)
            .then(function (r) {
              if (!r.ok) throw new Error("CSV not found");
              return r.text();
            })
            .then(function (text) {
              const lines = text.trim().split("\n");
              if (lines.length < 2) {
                status.textContent = "Žádná data.";
                return;
              }

              const headers = lines[0].split(",");
              const headerRow = document.createElement("tr");
              headers.forEach(function (h) {
                const th = document.createElement("th");
                th.textContent = h;
                headerRow.appendChild(th);
              });
              thead.appendChild(headerRow);

              // Show last 7 days
              var rows = lines.slice(1);
              var dates = [];
              var seen = {};
              for (var i = rows.length - 1; i >= 0; i--) {
                var d = rows[i].split(",")[0];
                if (!seen[d]) {
                  seen[d] = true;
                  dates.push(d);
                  if (dates.length >= 7) break;
                }
              }
              var last7 = new Set(dates);
              var filtered = rows.filter(function (r) { return last7.has(r.split(",")[0]); });

              filtered.forEach(function (line) {
                var cols = line.split(",");
                var tr = document.createElement("tr");
                cols.forEach(function (c) {
                  var td = document.createElement("td");
                  td.textContent = c;
                  tr.appendChild(td);
                });
                tbody.appendChild(tr);
              });

              status.style.display = "none";
            })
            .catch(function () {
              status.textContent = "Data pro " + year + " nejsou k dispozici.";
            });
        }

        loadData();
      })();
    </script>
  </body>
</html>
